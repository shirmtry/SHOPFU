<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Shop Mua Gói</title>
<style>
  /* ======= RESET ======= */
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: Arial, sans-serif;
    background: #f8f9fa;
    color: #333;
    padding: 20px;
  }
  a { text-decoration: none; }

  /* ======= HEADER USER ======= */
  .user-info {
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .user-info p { margin-bottom: 6px; }
  #username { font-weight: bold; color: #007bff; }
  #balance { font-weight: bold; color: #28a745; }

  /* ======= PACKAGE CARD ======= */
  .package {
    background: white;
    padding: 20px;
    margin: 15px 0;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    transition: 0.3s;
  }
  .package:hover { transform: translateY(-3px); }
  .package h3 { margin-bottom: 10px; }
  .price { color: #dc3545; font-weight: bold; margin-bottom: 15px; }
  .btn-buy {
    padding: 10px 18px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: 0.3s;
  }
  .btn-buy:hover { background: #218838; }

  /* ======= FOOTER ======= */
  footer {
    margin-top: 40px;
    text-align: center;
    color: #777;
    font-size: 14px;
  }
</style>
</head>
<body>

<!-- USER INFO -->
<div class="user-info">
  <p>Xin chào, <span id="username">Đang tải...</span></p>
  <p>Số dư: <span id="balance">0</span> VND</p>
</div>

<!-- PACKAGES -->
<div class="package">
  <h3>Gói Basic (TOOL SEB)</h3>
  <div class="price">100,000 VND</div>
  <button class="btn-buy" data-price="100000" data-package="basic">Mua ngay</button>
</div>

<div class="package">
  <h3>Gói VIP1 (TOOL EOS)</h3>
  <div class="price">200,000 VND</div>
  <button class="btn-buy" data-price="200000" data-package="vip1">Mua ngay</button>
</div>

<div class="package">
  <h3>Gói VIP2 (TOOL EOS + SEB)</h3>
  <div class="price">300,000 VND</div>
  <button class="btn-buy" data-price="300000" data-package="vip2">Mua ngay</button>
</div>

<div class="package">
  <h3>Gói VIP3 (TOOL EOS + SEB PRO)</h3>
  <div class="price">500,000 VND</div>
  <button class="btn-buy" data-price="500000" data-package="vip3">Mua ngay</button>
</div>

<!-- FOOTER -->
<footer>
  &copy; 2025 Cửa hàng Tool Online - Mọi quyền được bảo lưu.
</footer>

<script>
  // Chặn copy & chuột phải
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('selectstart', e => e.preventDefault());

  const API_URL = "https://script.google.com/macros/s/AKfycby-wQER7OQWR2WYTRqwjhHXa7IrrW8V8IqhPBe3eJMpguEor1myIwoXs0HSIeDFt1elEg/exec";
  let userData = { name: "", balance: 0 };

  async function fetchUserData() {
    try {
      const username = localStorage.getItem("username") || "";
      if (!username) {
        alert("Bạn chưa đăng nhập!");
        window.location.href = "login.html";
        return;
      }

      const res = await fetch(`${API_URL}?username=${encodeURIComponent(username)}`);
      if (!res.ok) throw new Error("Lỗi mạng");
      const data = await res.json();

      if (data && data.name && data.balance !== undefined) {
        userData = { name: data.name, balance: parseInt(data.balance) };
        updateUserDisplay();
      } else {
        throw new Error("Không tìm thấy dữ liệu người dùng");
      }
    } catch (err) {
      console.error("Lỗi tải dữ liệu:", err);
      alert("Không thể tải số dư, vui lòng thử lại sau.");
    }
  }

  function updateUserDisplay() {
    document.getElementById('username').textContent = userData.name;
    document.getElementById('balance').textContent = userData.balance.toLocaleString();
  }

  function handleBuyClick() {
    const price = parseInt(this.getAttribute('data-price'));
    const packageName = this.getAttribute('data-package');
    const packageDisplayNames = {
      'basic': 'Gói Basic (TOOL SEB)',
      'vip1': 'Gói VIP1 (TOOL EOS)',
      'vip2': 'Gói VIP2 (TOOL EOS + SEB)',
      'vip3': 'Gói VIP3 (TOOL EOS + SEB PRO)'
    };

    if (userData.balance >= price) {
      alert(`Bạn đã mua thành công ${packageDisplayNames[packageName]} với giá ${price.toLocaleString()} VND`);
      window.location.href = `thankyou.html?package=${encodeURIComponent(packageName)}`;
    } else {
      const needed = price - userData.balance;
      alert(`Bạn cần nạp thêm ${needed.toLocaleString()} VND để mua gói này`);
      window.location.href = `banking.html?package=${encodeURIComponent(packageName)}&amount=${needed}`;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    fetchUserData();
    document.querySelectorAll('.btn-buy').forEach(btn => {
      btn.addEventListener('click', handleBuyClick);
    });
  });
</script>

</body>
</html>
